- j_nk71
- DMOのプラットフォーム開発本部のSRE
# 開発組織の説明

- 事業部が60以上
- プラットフォーム開発本部
    - 120人
    - 30チーム
    - マイクロサービス30個
    - 信頼性にフルコミットできるチーム
        - いいなー
- マルチテナントのKubernetes Clusterベース
- 形式上のSLOはあったがエラーバジェットの概念もなかった
- SLOの見直しとかもしてなかった
- ここから導入を始める

# SLO導入運用のためにやったこと

- UserJourney 設定
- SLI 設計
- SLO 設計設定
- Error Budget policy 設計設定
- Burn Rate Alert 設計設定
- いっしょにドキュメントを作ろう
- よくある流れ

- ↑でやって！とは言えない...
- SLOはリテラシーがないと正しさがわからん
- サポートの必要がある！
- キックオフ、レビュー、見直し、運用サポ

- 短く概算して、1チームに3.5時間のレビューが必要
- 30チームあるから全部で105時間必要


- 例: 2-3件エラーが発生したら検知したい
    - SLOに検知の要素はないよ！バーンレートアラートが検知をする！
    - 検知の値を元にSLOの値を決定するのは不健全
- 例: 達成不可能な値を設定しちゃう
    - 526reqに対して99%だと、月間5件しかエラーが出せない！

- ドキュメント作ってる
    - 文字で書いても伝わらない...
- サポート結果をフィードバックしてFAQ作ってる
- 導入でもリテラシーを求められるし、導入後もかなり大変
- バーンレートアラートの偽陽性発火
    - 発火しやすくてバーンレート値を緩めたほうがいい
    - SLOが高すぎてなってしまってる
    - 200msがよかったが、500msじゃないとダメだった
    - 評価ウィンドウや集計関数の使い方が悪い
    - とか
    - どの修正をとるべきだったのか？など、むずい
- でかめなフローチャートを作ってる
    - 修正の複雑さを表している
- バーンレート値の修正
    - 設定ミスってる
- バーンレート値のカタログを作った
- どうなった？
    - 意思決定にエラーバジェットが活用された
    - ノイジーネイバーが発生した、pod増やして軽減できる場合があって、そのときの意思決定として使われていた
    - 50%切ってた
        - 依存先のキャッシュが死んでた
        - 障害レベルじゃないんだけど調査が発生して気づけた

# 課題、やっていきたいこと

- SLOの値の調整の最適化むずい
    - レビューフローの整備を構想
    - 運用側が達成可能な値を決めてね
    - ↓
    - ユーザーが満足する値に設定してね
    - 不可能な場合、エラーバジェットの削れ方とかで勝手に気づいてくれる
    - 次に、満足ラインってどうやって決めるの？
    - SLOを引き上げるモチベってない
        - そりゃそう
    - SLOどんどんあげるぞー→よくない
        - ユーザーは十分に満足しているのに高いコストを払って信頼性を引き上げ続けてしまう！
        - →やばい
        - 無駄に高い信頼性コスト
    - 事業部というユーザーがいる
        - 直接聞いちゃおう
        - ↑この人らにSLOの値のレビューをしてもらう
- ユーザージャーニーの表現ができていない
    - マイクロサービスSLO
        - 各マイクロサービスで定義する
        - 難易度の低さ的にこっちをやる
    - プラットフォームSLO
        - 事業部の体験により近いSLOを定義
    - プラットフォームSLOは、API Gatewayをも取り込んでしまう
        - 事業部の体験を表現できるようにしたいね
- リテラシーとコストがでかい
    - SLO as Code の導入
    - 定義からSLOを生成する仕組みを構想中
    - 設定の共通化、抽象化
        - レビュー可能！
        - リソース生成コスト低下
    - エンドポイント全部にGUIで設定するのは限界がある
    - → IaCによってリテラシーとコストが保たれるの、確かに
    - SaaS自体の実装とSLO Docの内容が一致しないといけない
        - SLO Doc自体もSLO as Codeから生成しちゃう
    - マイクロサービス同士の依存関係を管理できれば、依存先の値を参照したバリデーションが可能！
        - 依存先がルーズな値を使ってるから、我々の値はこれより厳しい値は設定できないよ〜 など
        - →あったら便利すぎる

- Q. SLOを決める際の非機能要件を汲んだ設定とかはどうレビューするか？
- A. 機会損失がいくら以下になるように設定したい、と思ってる(まだできてない)
- Q. うまくいったケース、いかなかったケース
- A. SLOを導入しようとしたが、計装が充分じゃなかった！
    - エラーが幾つなのかそもそもわからんかった
- A. エラーバジェットを100%にし続けたくなっちゃうチームがあった
    - どう文化を伝えるか？が今の焦点
- Q. CUJのレビュー時間が45分だった、妥当なのかどうかこれでいけるんか？相手をちゃんと知らないといけないよね？
- A. 最低限のチェックポイントを見る
    - エンドユーザーは開発者にしておく
        - 利用者を含めると大変
    - あなたたちはどういうサービスで、どういう機能を提供してるのか？を聞いてからレビューに入ってる、相手を知る時間は別途設けている
